



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://ddrscott.github.io/blog/2017/what-the-sql-recursive/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>What the SQL?!? Recursive</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-50126719-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="https://ddrscott.github.io/blog/2017/what-the-sql-recursive/" />
<meta name="twitter:creator" content="@_ddrscott_" />

  
<meta property="og:title" content="What the SQL?!? Recursive" />
  
  
<meta name="twitter:image" content="/images/i_heart_recursion.png" />
<meta property="og:image" content="/images/i_heart_recursion.png" />
  
  


  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#what-the-sql-recursive" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://ddrscott.github.io" title="Why, Scott, WHY?!?" aria-label="Why, Scott, WHY?!?" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Why, Scott, WHY?!?
            </span>
            <span class="md-header-nav__topic">
              
                What the SQL?!? Recursive
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://ddrscott.github.io" title="Why, Scott, WHY?!?" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Why, Scott, WHY?!?
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../projects/" title="Projects" class="md-nav__link">
      Projects
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Vim
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Vim
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/getting-rusty-with-vim/" title="Getting Rusty with Vim" class="md-nav__link">
      Getting Rusty with Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim-send-text/" title="Vim Send Text" class="md-nav__link">
      Vim Send Text
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/vim-toggle-movement/" title="Vim Toggle Movement: I Just Want to Go Home" class="md-nav__link">
      Vim Toggle Movement: I Just Want to Go Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/yank-without-jank/" title="Yank Without Jank" class="md-nav__link">
      Yank Without Jank
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/sidescroll/" title="Sensible Horizontal Scroll in Vim" class="md-nav__link">
      Sensible Horizontal Scroll in Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/side-search/" title="Vim Side Search: Making Search Fun Again" class="md-nav__link">
      Vim Side Search: Making Search Fun Again
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/making-a-window-submode/" title="Making a Window Submode in Vim" class="md-nav__link">
      Making a Window Submode in Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/bs-to-the-black-hole/" title="BS to the Black Hole" class="md-nav__link">
      BS to the Black Hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/negative-modulo/" title="PSA: Vim Modulo '%' Returns Negative Numbers!" class="md-nav__link">
      PSA: Vim Modulo '%' Returns Negative Numbers!
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2020/sql-ninja/" title="SQL + Jinja = Templating Done Right™" class="md-nav__link">
      SQL + Jinja = Templating Done Right™
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../what-the-sql-lateral/" title="What the SQL?! Lateral Joins" class="md-nav__link">
      What the SQL?! Lateral Joins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../what-the-sql-window/" title="What the SQL?! WINDOW" class="md-nav__link">
      What the SQL?! WINDOW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="./" title="What the SQL?! Recursive" class="md-nav__link">
      What the SQL?! Recursive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/join-me-at-union-station/" title="What the SQL?! JOIN me at UNION Station" class="md-nav__link">
      What the SQL?! JOIN me at UNION Station
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      2020
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        2020
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2020/sql-ninja/" title="SQL + Jinja = Templating Done Right™" class="md-nav__link">
      SQL + Jinja = Templating Done Right™
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/move-to-mkdocs/" title="Move to MkDocs" class="md-nav__link">
      Move to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/stream-stats-in-rust/" title="A Rustic Journey Through Stream Stats" class="md-nav__link">
      A Rustic Journey Through Stream Stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/getting-rusty-with-vim/" title="Getting Rusty with Vim" class="md-nav__link">
      Getting Rusty with Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/blog-setup/" title="Dev Blog Tools :: A Quick Tour of My Setup" class="md-nav__link">
      Dev Blog Tools :: A Quick Tour of My Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/join-me-at-union-station/" title="What the SQL?! JOIN me at UNION Station" class="md-nav__link">
      What the SQL?! JOIN me at UNION Station
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      2017
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        2017
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../base16-shell/" title="Base16 Shell" class="md-nav__link">
      Base16 Shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-get-better-at-anything/" title="How to Get Better At Anything" class="md-nav__link">
      How to Get Better At Anything
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fzf-dictionary/" title="FZF + WordNet = Dictionary" class="md-nav__link">
      FZF + WordNet = Dictionary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gnu-screen/" title="GNU Screen" class="md-nav__link">
      GNU Screen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../what-the-sql-lateral/" title="What the SQL?!? Lateral Joins" class="md-nav__link">
      What the SQL?!? Lateral Joins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../what-the-sql-window/" title="What the SQL?!? WINDOW" class="md-nav__link">
      What the SQL?!? WINDOW
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        What the SQL?!? Recursive
      </label>
    
    <a href="./" title="What the SQL?!? Recursive" class="md-nav__link md-nav__link--active">
      What the SQL?!? Recursive
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fibonacci-sequence" class="md-nav__link">
    Fibonacci Sequence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-solution" class="md-nav__link">
    SQL Solution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ins-and-outs" class="md-nav__link">
    The Ins and Outs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibonacci-results" class="md-nav__link">
    Fibonacci Results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-real-world-example-with-hierarchical-data" class="md-nav__link">
    A Real World Example with Hierarchical Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bait-and-switch" class="md-nav__link">
    Bait and Switch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#closing" class="md-nav__link">
    Closing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim-send-text/" title="Vim Send Text" class="md-nav__link">
      Vim Send Text
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      2016
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        2016
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/negative-modulo/" title="PSA: Vim Modulo '%' Returns Negative Numbers!" class="md-nav__link">
      PSA: Vim Modulo '%' Returns Negative Numbers!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/photography-lightening-talk/" title="Photography Refactored" class="md-nav__link">
      Photography Refactored
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/ruby-abuse/" title="Ruby Abuse: How Not to Write Ruby, But Still Have Fun" class="md-nav__link">
      Ruby Abuse: How Not to Write Ruby, But Still Have Fun
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/making-a-window-submode/" title="Making a Window Submode in Vim" class="md-nav__link">
      Making a Window Submode in Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/ansi-codes-with-character/" title="ANSI Codes with Character" class="md-nav__link">
      ANSI Codes with Character
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/vim-toggle-movement/" title="Vim Toggle Movement: I Just Want to Go Home" class="md-nav__link">
      Vim Toggle Movement: I Just Want to Go Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/yank-without-jank/" title="Yank Without Jank" class="md-nav__link">
      Yank Without Jank
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/sidescroll/" title="Sensible Horizontal Scroll in Vim" class="md-nav__link">
      Sensible Horizontal Scroll in Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/side-search/" title="Vim Side Search: Making Search Fun Again" class="md-nav__link">
      Vim Side Search: Making Search Fun Again
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2016/bs-to-the-black-hole/" title="BS to the Black Hole" class="md-nav__link">
      BS to the Black Hole
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      2014
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        2014
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2014/tech-stack-2014-edition/" title="Tech Stack 2014 Edition" class="md-nav__link">
      Tech Stack 2014 Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2014/octopress-to-the-rescue/" title="Octopress to the Rescue" class="md-nav__link">
      Octopress to the Rescue
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fibonacci-sequence" class="md-nav__link">
    Fibonacci Sequence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-solution" class="md-nav__link">
    SQL Solution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ins-and-outs" class="md-nav__link">
    The Ins and Outs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibonacci-results" class="md-nav__link">
    Fibonacci Results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-real-world-example-with-hierarchical-data" class="md-nav__link">
    A Real World Example with Hierarchical Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bait-and-switch" class="md-nav__link">
    Bait and Switch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#closing" class="md-nav__link">
    Closing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="what-the-sql-recursive">What the SQL?!? Recursive<a class="headerlink" href="#what-the-sql-recursive" title="Permanent link">&para;</a></h1>
<p><img src="/images/i_heart_recursion.png" alt='What the SQL?!? Recursive' /></p>
<p>Today's "What the SQL?!?" features the keyword <code>RECURSIVE</code>. This clause allows
us to elegantly select results from the previous results from the previous results
from the previous results...</p>
<!-- more -->

<p>Please note, our target database is PostgreSQL. These examples may work with
other databases, but might need some massaging to get them to work properly.
Search online for the specific vendor's documentation if errors pop up.
Try searching for "RECURSIVE queries {{DB VENDOR NAME}}". Not all database vendors
support the keyword <code>RECURSIVE</code>.</p>
<h2 id="fibonacci-sequence">Fibonacci Sequence<a class="headerlink" href="#fibonacci-sequence" title="Permanent link">&para;</a></h2>
<p>According to <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Wikipedia</a>:</p>
<blockquote>
<p>In mathematics, the Fibonacci numbers are the numbers in the following integer
sequence, called the Fibonacci sequence, and characterized by the fact that
every number after the first two is the sum of the two preceding ones:</p>
<div class="codehilite"><pre><span></span><code>1, 1, 2, 3, 5, 8, 13, 21, 34, 55 ...
</code></pre></div>


</blockquote>
<h2 id="sql-solution">SQL Solution<a class="headerlink" href="#sql-solution" title="Permanent link">&para;</a></h2>
<p>Our SQL solution will make use of the <code>RECURSIVE</code> <a href="https://www.postgresql.org/docs/9.3/static/queries-with.html">CTE</a>
keyword.</p>
<div class="codehilite"><pre><span></span><code><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fib</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
  <span class="k">SELECT</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">::</span><span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">::</span><span class="nb">NUMERIC</span>
  <span class="k">UNION</span> <span class="k">ALL</span>
  <span class="k">SELECT</span>
    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">fib</span><span class="p">,</span>
    <span class="n">fi</span> <span class="o">+</span> <span class="n">fib</span>
  <span class="k">FROM</span> <span class="n">t</span>
  <span class="k">WHERE</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span>
<span class="p">)</span>
<span class="k">SELECT</span>
  <span class="n">i</span><span class="p">,</span>
  <span class="n">fib</span>
<span class="k">FROM</span> <span class="n">t</span>
</code></pre></div>

<h2 id="the-ins-and-outs">The Ins and Outs<a class="headerlink" href="#the-ins-and-outs" title="Permanent link">&para;</a></h2>
<p>Here's some inline colorful comments to explain the sections:
<img src="/images/recursion_sql.png" alt='annotated SQL' /></p>
<p>Maybe arrows will help a little more with the flow of data:
<img src="/images/recursive_query.jpg" alt='Data Flow' /></p>
<h2 id="fibonacci-results">Fibonacci Results<a class="headerlink" href="#fibonacci-results" title="Permanent link">&para;</a></h2>
<p>When you run the query, you'll get the following results:</p>
<div class="codehilite"><pre><span></span><code> i  | fib
----+-----
  1 |   1
  2 |   1
  3 |   2
  4 |   3
  5 |   5
  6 |   8
  7 |  13
  8 |  21
  9 |  34
 10 |  55

(10 rows)
</code></pre></div>

<p>If you want to see the results for a high number, update <code>i &lt; 10</code> to a higher
value. If you go above <code>i &lt; 793</code>, Postgres gives up and returns <code>Nan</code> which means
<code>Not a number</code> which means the computed value is larger than your computer can
handle and still treat like a number. Sorry, get a new computer or work with
numbers less than 166 digits long.</p>
<h2 id="a-real-world-example-with-hierarchical-data">A Real World Example with Hierarchical Data<a class="headerlink" href="#a-real-world-example-with-hierarchical-data" title="Permanent link">&para;</a></h2>
<p>Fibonacci sequence is nice and all, but you have real data concerns. You're
thinking, "Show me the DATA!". So here's the data...</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Build `sample_people` table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sample_people</span> <span class="k">AS</span>
  <span class="k">SELECT</span>
    <span class="n">column1</span><span class="p">::</span><span class="nb">int</span>     <span class="k">AS</span> <span class="n">id</span><span class="p">,</span>
    <span class="n">column2</span><span class="p">::</span><span class="nb">varchar</span> <span class="k">AS</span> <span class="n">name</span><span class="p">,</span>
    <span class="n">column3</span><span class="p">::</span><span class="nb">int</span>     <span class="k">AS</span> <span class="n">parent_id</span>
  <span class="k">FROM</span> <span class="p">(</span>
    <span class="k">VALUES</span>
      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Root&#39;</span> <span class="p">,</span> <span class="k">null</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Cat&#39;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Dan&#39;</span>  <span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Evan&#39;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Frank&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
  <span class="p">)</span> <span class="k">as</span> <span class="n">t</span>
  <span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sample_people</span><span class="p">;</span>
<span class="c1">--  id | name  | parent_id</span>
<span class="c1">-- ----+-------+-----------</span>
<span class="c1">--   0 | Root  |</span>
<span class="c1">--   1 | Alice |         0</span>
<span class="c1">--   2 | Bob   |         1</span>
<span class="c1">--   3 | Cat   |         1</span>
<span class="c1">--   4 | Dan   |         3</span>
<span class="c1">--   5 | Evan  |         0</span>
<span class="c1">--   6 | Frank |         5</span>
</code></pre></div>

<p>Our <code>sample_people</code> table represents a person by name and that person may have a
parent. The parent of all the parents is <code>Root</code>.</p>
<p>And finally our recursive query to get a nice display of the hierarchy.</p>
<div class="codehilite"><pre><span></span><code><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">tree</span> <span class="c1">-- `tree` is the table alias.</span>
                    <span class="c1">-- It must be used as part of the `UNION` statement.</span>
  <span class="k">AS</span> <span class="p">(</span>
  <span class="c1">-- 1) Initialize table with all the top level rows.</span>
  <span class="c1">--    Anything without a parent is a parent. Is that apparent?</span>
  <span class="k">SELECT</span>
    <span class="mi">0</span> <span class="k">AS</span> <span class="k">level</span><span class="p">,</span>        <span class="c1">-- 2) Set the level to 0.</span>
    <span class="n">sample_people</span><span class="p">.</span><span class="o">*</span>    <span class="c1">-- 3) Return the initial row</span>
  <span class="k">FROM</span> <span class="n">sample_people</span>
  <span class="k">WHERE</span> <span class="n">parent_id</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">-- 4) Top level doesn&#39;t have a parent.</span>
  <span class="k">UNION</span> <span class="k">ALL</span>
  <span class="c1">-- 5) Union all the parents with their children.</span>
  <span class="k">SELECT</span>
    <span class="n">tree</span><span class="p">.</span><span class="k">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1">-- 6) Increment the level every time we loop.</span>
    <span class="n">sample_people</span><span class="p">.</span><span class="o">*</span>    <span class="c1">-- 7) Return the current row - the child row. </span>
  <span class="k">FROM</span> <span class="n">tree</span>    <span class="c1">-- 8) `tree` is populated with the previous results.</span>
               <span class="c1">--    Every loop gets a new record from current result.</span>
  <span class="k">JOIN</span> <span class="n">sample_people</span> <span class="k">ON</span> <span class="n">sample_people</span><span class="p">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">tree</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
<span class="k">SELECT</span>
  <span class="n">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="k">level</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">||</span> <span class="n">name</span> <span class="k">AS</span> <span class="n">display</span>
<span class="k">FROM</span> <span class="n">tree</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">level</span><span class="p">,</span> <span class="n">name</span>
<span class="p">;</span>

<span class="c1">--    display</span>
<span class="c1">-- -------------</span>
<span class="c1">--  Alice</span>
<span class="c1">--  Evan</span>
<span class="c1">--      Bob</span>
<span class="c1">--      Cat</span>
<span class="c1">--      Frank</span>
<span class="c1">--          Dan</span>
<span class="c1">-- (6 rows)</span>
</code></pre></div>

<h2 id="bait-and-switch">Bait and Switch<a class="headerlink" href="#bait-and-switch" title="Permanent link">&para;</a></h2>
<p><code>RECURSIVE</code> is not actually recursive. It isn't a function calling itself.
Sorry, not sorry. It's much closer to a <code>while</code> loop. Here's what Postgres has to say about it:</p>
<blockquote>
<p>Note: Strictly speaking, this process is <strong>iteration</strong> not recursion, but RECURSIVE
is the terminology chosen by the SQL standards committee. [emphasis added]</p>
</blockquote>
<h2 id="closing">Closing<a class="headerlink" href="#closing" title="Permanent link">&para;</a></h2>
<p>So the next time you try to crawl a hierarchy of data, we hope <code>RECURSIVE</code> comes
to mind. It's a great way to save round trips to the database and query what is
needed based on the data's structure. Think of all the nested subqueries we can
save together!</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>Postgres WITH Queries: <a href="https://www.postgresql.org/docs/9.3/static/queries-with.html">https://www.postgresql.org/docs/9.3/static/queries-with.html</a></li>
<li>Wikipedia Fibonacci number: <a href="https://en.wikipedia.org/wiki/Fibonacci_number">https://en.wikipedia.org/wiki/Fibonacci_number</a></li>
</ul>
                
                  
                
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://ddrscott.github.io/blog/2017/what-the-sql-recursive/";
      this.page.identifier =
        "/blog/2017/what-the-sql-recursive/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//ddrscottgithubio.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../what-the-sql-window/" title="What the SQL?!? WINDOW" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                What the SQL?!? WINDOW
              </span>
            </div>
          </a>
        
        
          <a href="../vim-send-text/" title="Vim Send Text" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Vim Send Text
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014 - 2018 Scott Pierce
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/ddrscott" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/_ddrscott_" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
        <script src="https://platform.twitter.com/widgets.js"></script>
      
    
  </body>
</html>